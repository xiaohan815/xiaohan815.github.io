<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Hooks | xh的博客</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="A REST and real-time API layer for modern applications">
    
    <link rel="preload" href="/assets/css/0.styles.71eccbd5.css" as="style"><link rel="preload" href="/assets/js/app.f4b1d533.js" as="script"><link rel="preload" href="/assets/js/3.7ef197bc.js" as="script"><link rel="preload" href="/assets/js/37.03460d49.js" as="script"><link rel="prefetch" href="/assets/js/10.75479bb3.js"><link rel="prefetch" href="/assets/js/11.06dc4d05.js"><link rel="prefetch" href="/assets/js/12.b400be4b.js"><link rel="prefetch" href="/assets/js/13.468db7cc.js"><link rel="prefetch" href="/assets/js/14.c0fd1ba2.js"><link rel="prefetch" href="/assets/js/15.decd1b48.js"><link rel="prefetch" href="/assets/js/16.5dd5709b.js"><link rel="prefetch" href="/assets/js/17.d4f6d12f.js"><link rel="prefetch" href="/assets/js/18.fe8ad097.js"><link rel="prefetch" href="/assets/js/19.937b245a.js"><link rel="prefetch" href="/assets/js/20.7cc52ec4.js"><link rel="prefetch" href="/assets/js/21.05c5bcbb.js"><link rel="prefetch" href="/assets/js/22.c617dc8b.js"><link rel="prefetch" href="/assets/js/23.4e0a4ba3.js"><link rel="prefetch" href="/assets/js/24.3ddb4d5e.js"><link rel="prefetch" href="/assets/js/25.ce1df76d.js"><link rel="prefetch" href="/assets/js/26.c258552f.js"><link rel="prefetch" href="/assets/js/27.bf72b2a4.js"><link rel="prefetch" href="/assets/js/28.f36eb311.js"><link rel="prefetch" href="/assets/js/29.a8389ebb.js"><link rel="prefetch" href="/assets/js/30.1bb11e5b.js"><link rel="prefetch" href="/assets/js/31.420db076.js"><link rel="prefetch" href="/assets/js/32.227f3c52.js"><link rel="prefetch" href="/assets/js/33.74f30a07.js"><link rel="prefetch" href="/assets/js/34.6800baab.js"><link rel="prefetch" href="/assets/js/35.1364295d.js"><link rel="prefetch" href="/assets/js/36.1f3555c4.js"><link rel="prefetch" href="/assets/js/38.7288c585.js"><link rel="prefetch" href="/assets/js/39.be2cc39a.js"><link rel="prefetch" href="/assets/js/4.69d337f5.js"><link rel="prefetch" href="/assets/js/40.25a2c3c6.js"><link rel="prefetch" href="/assets/js/41.00f9dadf.js"><link rel="prefetch" href="/assets/js/42.5befdd01.js"><link rel="prefetch" href="/assets/js/43.35a181f3.js"><link rel="prefetch" href="/assets/js/44.40ab2e80.js"><link rel="prefetch" href="/assets/js/45.ef5a1522.js"><link rel="prefetch" href="/assets/js/46.933ea0fe.js"><link rel="prefetch" href="/assets/js/47.bdc1d06e.js"><link rel="prefetch" href="/assets/js/48.2a8183d7.js"><link rel="prefetch" href="/assets/js/49.df5b3519.js"><link rel="prefetch" href="/assets/js/5.819c231b.js"><link rel="prefetch" href="/assets/js/50.f6e77e4d.js"><link rel="prefetch" href="/assets/js/51.52640232.js"><link rel="prefetch" href="/assets/js/52.887b891d.js"><link rel="prefetch" href="/assets/js/53.0a327f41.js"><link rel="prefetch" href="/assets/js/54.5855f8f3.js"><link rel="prefetch" href="/assets/js/55.376b3041.js"><link rel="prefetch" href="/assets/js/56.8d2aae84.js"><link rel="prefetch" href="/assets/js/57.945b40cd.js"><link rel="prefetch" href="/assets/js/58.fce6fb60.js"><link rel="prefetch" href="/assets/js/59.efb6444b.js"><link rel="prefetch" href="/assets/js/6.bfb1454e.js"><link rel="prefetch" href="/assets/js/60.721cd48d.js"><link rel="prefetch" href="/assets/js/61.356f751f.js"><link rel="prefetch" href="/assets/js/62.9538717e.js"><link rel="prefetch" href="/assets/js/7.3aae742d.js"><link rel="prefetch" href="/assets/js/8.41a4751c.js"><link rel="prefetch" href="/assets/js/9.45376988.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.5e84523f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.71eccbd5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/feathers-logo-wide.png" alt="xh的博客" class="logo"></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/guides/" class="nav-link">Guides</a></div><div class="nav-item"><a href="/api/" class="nav-link router-link-active">API</a></div><div class="nav-item"><a href="/cookbook/" class="nav-link">Cookbook</a></div><div class="nav-item"><a href="/help/" class="nav-link">Help</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Ecosystem</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/feathersjs/awesome-feathersjs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Awesome Feathersjs
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.youtube.com/playlist?list=PLwSdIiqnDlf_lb5y1liQK2OW5daXYgKOe" target="_blank" rel="noopener noreferrer" class="nav-link external">
  YouTube Playlist
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://vuex.feathersjs.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Feathers VueX
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://hooks-common.feathersjs.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Common Hooks
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><h4>Other versions</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://dove.docs.feathersjs.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Dove (v5, next)
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://buzzard.docs.feathersjs.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Buzzard (v3)
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://auk.docs.feathersjs.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Auk (v2)
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div> <a href="https://github.com/feathersjs/feathers" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/guides/" class="nav-link">Guides</a></div><div class="nav-item"><a href="/api/" class="nav-link router-link-active">API</a></div><div class="nav-item"><a href="/cookbook/" class="nav-link">Cookbook</a></div><div class="nav-item"><a href="/help/" class="nav-link">Help</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Ecosystem</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/feathersjs/awesome-feathersjs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Awesome Feathersjs
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.youtube.com/playlist?list=PLwSdIiqnDlf_lb5y1liQK2OW5daXYgKOe" target="_blank" rel="noopener noreferrer" class="nav-link external">
  YouTube Playlist
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://vuex.feathersjs.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Feathers VueX
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://hooks-common.feathersjs.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Common Hooks
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><h4>Other versions</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://dove.docs.feathersjs.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Dove (v5, next)
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://buzzard.docs.feathersjs.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Buzzard (v3)
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://auk.docs.feathersjs.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Auk (v2)
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div> <a href="https://github.com/feathersjs/feathers" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Core</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/api/application.html" class="sidebar-link">Application</a></li><li><a href="/api/services.html" class="sidebar-link">Services</a></li><li><a href="/api/hooks.html" aria-current="page" class="active sidebar-link">Hooks</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/api/hooks.html#quick-example" class="sidebar-link">Quick Example</a></li><li class="sidebar-sub-header"><a href="/api/hooks.html#hook-functions" class="sidebar-link">Hook functions</a></li><li class="sidebar-sub-header"><a href="/api/hooks.html#hook-context" class="sidebar-link">Hook context</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/api/hooks.html#context-app" class="sidebar-link">context.app</a></li><li class="sidebar-sub-header"><a href="/api/hooks.html#context-service" class="sidebar-link">context.service</a></li><li class="sidebar-sub-header"><a href="/api/hooks.html#context-path" class="sidebar-link">context.path</a></li><li class="sidebar-sub-header"><a href="/api/hooks.html#context-method" class="sidebar-link">context.method</a></li><li class="sidebar-sub-header"><a href="/api/hooks.html#context-type" class="sidebar-link">context.type</a></li><li class="sidebar-sub-header"><a href="/api/hooks.html#context-params" class="sidebar-link">context.params</a></li><li class="sidebar-sub-header"><a href="/api/hooks.html#context-id" class="sidebar-link">context.id</a></li><li class="sidebar-sub-header"><a href="/api/hooks.html#context-data" class="sidebar-link">context.data</a></li><li class="sidebar-sub-header"><a href="/api/hooks.html#context-error" class="sidebar-link">context.error</a></li><li class="sidebar-sub-header"><a href="/api/hooks.html#context-result" class="sidebar-link">context.result</a></li><li class="sidebar-sub-header"><a href="/api/hooks.html#context-dispatch" class="sidebar-link">context.dispatch</a></li><li class="sidebar-sub-header"><a href="/api/hooks.html#context-statuscode" class="sidebar-link">context.statusCode</a></li><li class="sidebar-sub-header"><a href="/api/hooks.html#context-event" class="sidebar-link">context.event</a></li></ul></li><li class="sidebar-sub-header"><a href="/api/hooks.html#hook-flow" class="sidebar-link">Hook flow</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/api/hooks.html#throwing-an-error" class="sidebar-link">Throwing an error</a></li><li class="sidebar-sub-header"><a href="/api/hooks.html#setting-context-result" class="sidebar-link">Setting context.result</a></li></ul></li><li class="sidebar-sub-header"><a href="/api/hooks.html#asynchronous-hooks" class="sidebar-link">Asynchronous hooks</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/api/hooks.html#async-await" class="sidebar-link">async/await</a></li><li class="sidebar-sub-header"><a href="/api/hooks.html#converting-callbacks" class="sidebar-link">Converting callbacks</a></li></ul></li><li class="sidebar-sub-header"><a href="/api/hooks.html#registering-hooks" class="sidebar-link">Registering hooks</a></li><li class="sidebar-sub-header"><a href="/api/hooks.html#application-hooks" class="sidebar-link">Application hooks</a></li></ul></li><li><a href="/api/events.html" class="sidebar-link">Events</a></li><li><a href="/api/errors.html" class="sidebar-link">Errors</a></li><li><a href="/api/configuration.html" class="sidebar-link">Configuration</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Transports</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/api/express.html" class="sidebar-link">Express</a></li><li><a href="/api/socketio.html" class="sidebar-link">Socket.io</a></li><li><a href="/api/primus.html" class="sidebar-link">Primus</a></li><li><a href="/api/channels.html" class="sidebar-link">Channels</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Client</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/api/client.html" class="sidebar-link">Feathers Client</a></li><li><a href="/api/client/rest.html" class="sidebar-link">REST Client</a></li><li><a href="/api/client/socketio.html" class="sidebar-link">Socket.io Client</a></li><li><a href="/api/client/primus.html" class="sidebar-link">Primus Client</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Authentication</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/api/authentication/" class="sidebar-link">Overview</a></li><li><a href="/api/authentication/service.html" class="sidebar-link">Service</a></li><li><a href="/api/authentication/strategy.html" class="sidebar-link">Strategies</a></li><li><a href="/api/authentication/hook.html" class="sidebar-link">Hook</a></li><li><a href="/api/authentication/jwt.html" class="sidebar-link">JWT</a></li><li><a href="/api/authentication/local.html" class="sidebar-link">Local</a></li><li><a href="/api/authentication/oauth.html" class="sidebar-link">OAuth</a></li><li><a href="/api/authentication/client.html" class="sidebar-link">Client</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Databases</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/api/databases/adapters.html" class="sidebar-link">Overview</a></li><li><a href="/api/databases/common.html" class="sidebar-link">Common API</a></li><li><a href="/api/databases/querying.html" class="sidebar-link">Querying</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="content content__default"><h1 id="hooks"><a href="#hooks" class="header-anchor">#</a> Hooks</h1> <p>Hooks are pluggable middleware functions that can be registered <strong>before</strong>, <strong>after</strong> or on <strong>error</strong>(s) of a <a href="/api/services.html">service method</a>. You can register a single hook function or create a chain of them to create complex work-flows. Most of the time multiple hooks are registered so the examples show the &quot;hook chain&quot; array style registration.</p> <p>A hook is <strong>transport independent</strong>, which means it does not matter if it has been called through HTTP(S) (REST), Socket.io, Primus or any other transport Feathers may support in the future. They are also service agnostic, meaning they can be used with ​<strong>any</strong>​ service regardless of whether they have a model or not.</p> <p>Hooks are commonly used to handle things like validation, logging, populating related entities, sending notifications and more. This pattern keeps your application logic flexible, composable, and much easier to trace through and debug. For more information about the design patterns behind hooks see <a href="https://blog.feathersjs.com/api-service-composition-with-hooks-47af13aa6c01" target="_blank" rel="noopener noreferrer">this blog post<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h2 id="quick-example"><a href="#quick-example" class="header-anchor">#</a> Quick Example</h2> <p>The following example adds a <code>createdAt</code> and <code>updatedAt</code> property before saving the data to the database and logs any errors on the service:</p> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="javascript" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> feathers <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@feathersjs/feathers'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">feathers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">service</span><span class="token punctuation">(</span><span class="token string">'messages'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hooks</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  before<span class="token operator">:</span> <span class="token punctuation">{</span>
    create<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">async</span> <span class="token parameter">context</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      context<span class="token punctuation">.</span>data<span class="token punctuation">.</span>createdAt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">return</span> context<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

    update<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">async</span> <span class="token parameter">context</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      context<span class="token punctuation">.</span>data<span class="token punctuation">.</span>updatedAt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">return</span> context<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

    patch<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">async</span> <span class="token parameter">context</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      context<span class="token punctuation">.</span>data<span class="token punctuation">.</span>updatedAt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">return</span> context<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  error<span class="token operator">:</span> <span class="token punctuation">{</span>
    all<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">async</span> <span class="token parameter">context</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Error in </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>context<span class="token punctuation">.</span>path<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> calling </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>context<span class="token punctuation">.</span>method<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">  method</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> context<span class="token punctuation">.</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">return</span> context<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="typescript" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token keyword">default</span> <span class="token keyword">as</span> feathers<span class="token punctuation">,</span> HookContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@feathersjs/feathers'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">feathers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">service</span><span class="token punctuation">(</span><span class="token string">'messages'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hooks</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  before<span class="token operator">:</span> <span class="token punctuation">{</span>
    create<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token operator">:</span> HookContext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      context<span class="token punctuation">.</span>data<span class="token punctuation">.</span>createdAt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">return</span> context<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

    update<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token operator">:</span> HookContext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      context<span class="token punctuation">.</span>data<span class="token punctuation">.</span>updatedAt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">return</span> context<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

    patch<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token operator">:</span> HookContext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      context<span class="token punctuation">.</span>data<span class="token punctuation">.</span>updatedAt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      <span class="token keyword">return</span> context<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  error<span class="token operator">:</span> <span class="token punctuation">{</span>
    all<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token operator">:</span> HookContext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Error in </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>context<span class="token punctuation">.</span>path<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> calling </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>context<span class="token punctuation">.</span>method<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">  method</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> context<span class="token punctuation">.</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">return</span> context<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h2 id="hook-functions"><a href="#hook-functions" class="header-anchor">#</a> Hook functions</h2> <p>A hook function can be a normal or <code>async</code> function that takes the <a href="#hook-context">hook context</a> as the parameter and returns the <code>context</code> object, <code>undefined</code> or throws an error.</p> <p>For more information see the <a href="#hook-flow">hook flow</a> and <a href="#asynchronous-hooks">asynchronous hooks</a> section.</p> <h2 id="hook-context"><a href="#hook-context" class="header-anchor">#</a> Hook context</h2> <p>The hook <code>context</code> is passed to a hook function and contains information about the service method call. It has <strong>read only</strong> properties that should not be modified and <em><strong>writeable</strong></em> properties that can be changed for subsequent hooks.</p> <blockquote><p><strong>Pro Tip:</strong> The <code>context</code> object is the same throughout a service method call so it is possible to add properties and use them in other hooks at a later time.</p></blockquote> <h3 id="context-app"><a href="#context-app" class="header-anchor">#</a> context.app</h3> <p><code>context.app</code> is a <em>read only</em> property that contains the <a href="/api/application.html">Feathers application object</a>. This can be used to retrieve other services (via <code>context.app.service('name')</code>) or configuration values.</p> <h3 id="context-service"><a href="#context-service" class="header-anchor">#</a> context.service</h3> <p><code>context.service</code> is a <em>read only</em> property and contains the service this hook currently runs on.</p> <h3 id="context-path"><a href="#context-path" class="header-anchor">#</a> context.path</h3> <p><code>context.path</code> is a <em>read only</em> property and contains the service name (or path) without leading or trailing slashes.</p> <h3 id="context-method"><a href="#context-method" class="header-anchor">#</a> context.method</h3> <p><code>context.method</code> is a <em>read only</em> property with the name of the <a href="/api/services.html">service method</a> (<code>find</code>, <code>get</code>, <code>create</code>, <code>update</code>, <code>patch</code>, <code>remove</code>).</p> <h3 id="context-type"><a href="#context-type" class="header-anchor">#</a> context.type</h3> <p><code>context.type</code> is a <em>read only</em> property with the hook type (one of <code>before</code>, <code>after</code> or <code>error</code>).</p> <h3 id="context-params"><a href="#context-params" class="header-anchor">#</a> context.params</h3> <p><code>context.params</code> is a <strong>writeable</strong> property that contains the <a href="/api/services.html">service method</a> parameters (including <code>params.query</code>). For more information see the <a href="/api/services.html#params">service params documentation</a>.</p> <h3 id="context-id"><a href="#context-id" class="header-anchor">#</a> context.id</h3> <p><code>context.id</code> is a <strong>writeable</strong> property and the <code>id</code> for a <code>get</code>, <code>remove</code>, <code>update</code> and <code>patch</code> service method call. For <code>remove</code>, <code>update</code> and <code>patch</code> <code>context.id</code> can also be <code>null</code> when modifying multiple entries. In all other cases it will be <code>undefined</code>.</p> <blockquote><p><strong>Note:</strong> <code>context.id</code> is only available for method types <code>get</code>, <code>remove</code>, <code>update</code> and <code>patch</code>.</p></blockquote> <h3 id="context-data"><a href="#context-data" class="header-anchor">#</a> context.data</h3> <p><code>context.data</code> is a <strong>writeable</strong> property containing the data of a <code>create</code>, <code>update</code> and <code>patch</code> service method call.</p> <blockquote><p><strong>Note:</strong> <code>context.data</code> will only be available for method types <code>create</code>, <code>update</code> and <code>patch</code>.</p></blockquote> <h3 id="context-error"><a href="#context-error" class="header-anchor">#</a> context.error</h3> <p><code>context.error</code> is a <strong>writeable</strong> property with the error object that was thrown in a failed method call. It is only available in <code>error</code> hooks.</p> <blockquote><p><strong>Note:</strong> <code>context.error</code> will only be available if <code>context.type</code> is <code>error</code>.</p></blockquote> <h3 id="context-result"><a href="#context-result" class="header-anchor">#</a> context.result</h3> <p><code>context.result</code> is a <strong>writeable</strong> property containing the result of the successful service method call. It is only available in <code>after</code> hooks. <code>context.result</code> can also be set in</p> <ul><li>A <code>before</code> hook to skip the actual service method (database) call</li> <li>An <code>error</code> hook to swallow the error and return a result instead</li></ul> <blockquote><p><strong>Note:</strong> <code>context.result</code> will only be available if <code>context.type</code> is <code>after</code> or if <code>context.result</code> has been set.</p></blockquote> <h3 id="context-dispatch"><a href="#context-dispatch" class="header-anchor">#</a> context.dispatch</h3> <p><code>context.dispatch</code> is a <strong>writeable, optional</strong> property and contains a &quot;safe&quot; version of the data that should be sent to any client. If <code>context.dispatch</code> has not been set <code>context.result</code> will be sent to the client instead.</p> <blockquote><p><strong>Note:</strong> <code>context.dispatch</code> only affects the data sent through a Feathers Transport like <a href="/api/express.html">REST</a> or <a href="/api/socketio.html">Socket.io</a>. An internal method call will still get the data set in <code>context.result</code>.</p></blockquote> <h3 id="context-statuscode"><a href="#context-statuscode" class="header-anchor">#</a> context.statusCode</h3> <p><code>context.statusCode</code> is a <strong>writeable, optional</strong> property that allows to override the standard <a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html" target="_blank" rel="noopener noreferrer">HTTP status code<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> that should be returned.</p> <h3 id="context-event"><a href="#context-event" class="header-anchor">#</a> context.event</h3> <p><code>context.event</code> is a <strong>writeable, optional</strong> property that allows service events to be skipped by setting it to <code>null</code></p> <h2 id="hook-flow"><a href="#hook-flow" class="header-anchor">#</a> Hook flow</h2> <p>In general, hooks are executed in the order they are registered with the original service method being called after all <code>before</code> hooks. This flow can be affected as follows.</p> <h3 id="throwing-an-error"><a href="#throwing-an-error" class="header-anchor">#</a> Throwing an error</h3> <p>When an error is thrown (or the promise is rejected), all subsequent hooks - and the service method call if it didn't run already - will be skipped and only the error hooks will run.</p> <p>The following example throws an error when the text for creating a new message is empty. You can also create very similar hooks to use your Node validation library of choice.</p> <div class="language-js extra-class"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">service</span><span class="token punctuation">(</span><span class="token string">'messages'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hooks</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  before<span class="token operator">:</span> <span class="token punctuation">{</span>
    create<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token parameter">context</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>data<span class="token punctuation">.</span>text<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Message text can not be empty'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="setting-context-result"><a href="#setting-context-result" class="header-anchor">#</a> Setting <code>context.result</code></h3> <p>When <code>context.result</code> is set in a <code>before</code> hook, the original <a href="/api/services.html">service method</a> call will be skipped. All other hooks will still execute in their normal order. The following example always returns the currently <a href="/api/authentication/service.html">authenticated user</a> instead of the actual user for all <code>get</code> method calls:</p> <div class="language-js extra-class"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">service</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hooks</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  before<span class="token operator">:</span> <span class="token punctuation">{</span>
    get<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token parameter">context</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// Never call the actual users service</span>
        <span class="token comment">// just use the authenticated user</span>
        context<span class="token punctuation">.</span>result <span class="token operator">=</span> context<span class="token punctuation">.</span>params<span class="token punctuation">.</span>user<span class="token punctuation">;</span>

        <span class="token keyword">return</span> context<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="asynchronous-hooks"><a href="#asynchronous-hooks" class="header-anchor">#</a> Asynchronous hooks</h2> <p>When the hook function is <code>async</code> or a Promise is returned it will wait until all asynchronous operations resolve or reject before continuing to the next hook.</p> <blockquote><p><strong>Important:</strong> As stated in the <a href="#hook-functions">hook functions</a> section the promise has to either resolve with the <code>context</code> object (usually done with <code>.then(() =&gt; context)</code> at the end of the promise chain) or with <code>undefined</code>.</p></blockquote> <h3 id="async-await"><a href="#async-await" class="header-anchor">#</a> async/await</h3> <p>The use of <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function" target="_blank" rel="noopener noreferrer">async/await<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> is highly recommended. This will avoid many common issues when using Promises and asynchronous hook flows. Any hook function can be <code>async</code> in which case it will wait until all <code>await</code> operations are completed. Just like a normal hook it should return the <code>context</code> object or <code>undefined</code>.</p> <p>The following example shows an async/await hook that uses another service to retrieve and populate the messages <code>user</code> when getting a single message:</p> <div class="language-js extra-class"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">service</span><span class="token punctuation">(</span><span class="token string">'messages'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hooks</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  after<span class="token operator">:</span> <span class="token punctuation">{</span>
    get<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token keyword">async</span> <span class="token parameter">context</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> userId <span class="token operator">=</span> context<span class="token punctuation">.</span>result<span class="token punctuation">.</span>userId<span class="token punctuation">;</span>

        <span class="token comment">// Since context.app.service('users').get returns a promise we can `await` it</span>
        <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> context<span class="token punctuation">.</span>app<span class="token punctuation">.</span><span class="token function">service</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Update the result (the message)</span>
        context<span class="token punctuation">.</span>result<span class="token punctuation">.</span>user <span class="token operator">=</span> user<span class="token punctuation">;</span>

        <span class="token comment">// Returning will resolve the promise with the `context` object</span>
        <span class="token keyword">return</span> context<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The following example shows an asynchronous hook that uses another service to retrieve and populate the messages <code>user</code> when getting a single message.</p> <div class="language-js extra-class"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">service</span><span class="token punctuation">(</span><span class="token string">'messages'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hooks</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  after<span class="token operator">:</span> <span class="token punctuation">{</span>
    get<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token keyword">async</span> <span class="token parameter">context</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> userId <span class="token operator">=</span> context<span class="token punctuation">.</span>result<span class="token punctuation">.</span>userId<span class="token punctuation">;</span>

        <span class="token comment">// Also pass the `params` so we get a secure version of the user</span>
        <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> context<span class="token punctuation">.</span>app<span class="token punctuation">.</span><span class="token function">service</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> context<span class="token punctuation">.</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>

        context<span class="token punctuation">.</span>result<span class="token punctuation">.</span>user <span class="token operator">=</span> user<span class="token punctuation">;</span>

        <span class="token comment">// Returning will resolve the promise with the `context` object</span>
        <span class="token keyword">return</span> context<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p><strong>Note:</strong> A common issue when hooks are not running in the expected order is a missing <code>await</code> statement.</p></blockquote> <blockquote><p><strong>Important:</strong> Most Feathers service calls and newer Node packages already return Promises. They can be returned and chained directly. There usually is no need to instantiate your own <code>new Promise</code> instance.</p></blockquote> <h3 id="converting-callbacks"><a href="#converting-callbacks" class="header-anchor">#</a> Converting callbacks</h3> <p>When the asynchronous operation is using a <em>callback</em> instead of returning a promise you have to create and return a new Promise (<code>new Promise((resolve, reject) =&gt; {})</code>) or use <a href="https://nodejs.org/api/util.html#util_util_promisify_original" target="_blank" rel="noopener noreferrer">util.promisify<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>The following example reads a JSON file converting <a href="https://nodejs.org/api/fs.html#fs_fs_readfile_file_options_callback" target="_blank" rel="noopener noreferrer">fs.readFile<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> with <code>util.promisify</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> util <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'util'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> readFile <span class="token operator">=</span> util<span class="token punctuation">.</span><span class="token function">promisify</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span>readFile<span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">service</span><span class="token punctuation">(</span><span class="token string">'messages'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hooks</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  after<span class="token operator">:</span> <span class="token punctuation">{</span>
    get<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token keyword">async</span> <span class="token parameter">context</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./myfile.json'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        context<span class="token punctuation">.</span>result<span class="token punctuation">.</span>myFile <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> context<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="registering-hooks"><a href="#registering-hooks" class="header-anchor">#</a> Registering hooks</h2> <p>Hook functions are registered on a service through the <code>app.service(&lt;servicename&gt;).hooks(hooks)</code> method. There are several options for what can be passed as <code>hooks</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// The standard all at once way (also used by the generator)</span>
<span class="token comment">// an array of functions per service method name (and for `all` methods)</span>
app<span class="token punctuation">.</span><span class="token function">service</span><span class="token punctuation">(</span><span class="token string">'servicename'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hooks</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  before<span class="token operator">:</span> <span class="token punctuation">{</span>
    all<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token comment">// Use normal functions</span>
      <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'before all hook ran'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    find<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token comment">// Use ES6 arrow functions</span>
      <span class="token parameter">context</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'before find hook 1 ran'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token parameter">context</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'before find hook 2 ran'</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    get<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token comment">/* other hook functions here */</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
    create<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    update<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    patch<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    remove<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  after<span class="token operator">:</span> <span class="token punctuation">{</span>
    all<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    find<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    get<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    create<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    update<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    patch<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    remove<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  error<span class="token operator">:</span> <span class="token punctuation">{</span>
    all<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    find<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    get<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    create<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    update<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    patch<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    remove<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Register a single hook before, after and on error for all methods</span>
app<span class="token punctuation">.</span><span class="token function">service</span><span class="token punctuation">(</span><span class="token string">'servicename'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hooks</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">before</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'before all hook ran'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">after</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'after all hook ran'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">error</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'error all hook ran'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p><strong>Pro Tip:</strong> When using the full object, <code>all</code> is a special keyword meaning this hook will run for all methods. <code>all</code> hooks will be registered before other method specific hooks.</p></blockquote> <blockquote><p><strong>Pro Tip:</strong> <code>app.service(&lt;servicename&gt;).hooks(hooks)</code> can be called multiple times and the hooks will be registered in that order. Normally all hooks should be registered at once however to see at a glance what the service is going to do.</p></blockquote> <h2 id="application-hooks"><a href="#application-hooks" class="header-anchor">#</a> Application hooks</h2> <p>To add hooks to every service <code>app.hooks(hooks)</code> can be used. Application hooks are <a href="#registering-hooks">registered in the same format as service hooks</a> and also work exactly the same. Note when application hooks will be executed however:</p> <ul><li><code>before</code> application hooks will always run <em>before</em> all service <code>before</code> hooks</li> <li><code>after</code> application hooks will always run <em>after</em> all service <code>after</code> hooks</li> <li><code>error</code> application hooks will always run <em>after</em> all service <code>error</code> hooks</li></ul> <p>Here is an example for a very useful application hook that logs every service method error with the service and method name as well as the error stack.</p> <div class="language-js extra-class"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">hooks</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">error</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Error in '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>context<span class="token punctuation">.</span>path<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">' service method '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>context<span class="token punctuation">.</span>method<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">'</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> context<span class="token punctuation">.</span>error<span class="token punctuation">.</span>stack<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p><strong>Note:</strong> generated applications come with <code>src/app.hooks.js</code> containing hooks that run for every service.</p></blockquote></div> <footer class="page-edit"><blockquote><p>
        Anything unclear or missing?
        <a href="/help" rel="noopener noreferrer">
          Get help
        </a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span> or <a href="https://github.com/feathersjs/docs/edit/crow/api/hooks.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></p> <small><span class="prefix">Last Updated: </span> <span class="time">7/12/2020, 1:34:23 AM</span></small></blockquote></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/api/services.html" class="prev">
          Services
        </a></span> <span class="next"><a href="/api/events.html">
          Events
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.f4b1d533.js" defer></script><script src="/assets/js/3.7ef197bc.js" defer></script><script src="/assets/js/37.03460d49.js" defer></script>
  </body>
</html>
