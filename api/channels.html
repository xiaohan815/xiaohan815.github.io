<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Channels | xh的博客</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="A REST and real-time API layer for modern applications">
    
    <link rel="preload" href="/assets/css/0.styles.71eccbd5.css" as="style"><link rel="preload" href="/assets/js/app.f4b1d533.js" as="script"><link rel="preload" href="/assets/js/3.7ef197bc.js" as="script"><link rel="preload" href="/assets/js/25.ce1df76d.js" as="script"><link rel="prefetch" href="/assets/js/10.75479bb3.js"><link rel="prefetch" href="/assets/js/11.06dc4d05.js"><link rel="prefetch" href="/assets/js/12.b400be4b.js"><link rel="prefetch" href="/assets/js/13.468db7cc.js"><link rel="prefetch" href="/assets/js/14.c0fd1ba2.js"><link rel="prefetch" href="/assets/js/15.decd1b48.js"><link rel="prefetch" href="/assets/js/16.5dd5709b.js"><link rel="prefetch" href="/assets/js/17.d4f6d12f.js"><link rel="prefetch" href="/assets/js/18.fe8ad097.js"><link rel="prefetch" href="/assets/js/19.937b245a.js"><link rel="prefetch" href="/assets/js/20.7cc52ec4.js"><link rel="prefetch" href="/assets/js/21.05c5bcbb.js"><link rel="prefetch" href="/assets/js/22.c617dc8b.js"><link rel="prefetch" href="/assets/js/23.4e0a4ba3.js"><link rel="prefetch" href="/assets/js/24.3ddb4d5e.js"><link rel="prefetch" href="/assets/js/26.c258552f.js"><link rel="prefetch" href="/assets/js/27.bf72b2a4.js"><link rel="prefetch" href="/assets/js/28.f36eb311.js"><link rel="prefetch" href="/assets/js/29.a8389ebb.js"><link rel="prefetch" href="/assets/js/30.1bb11e5b.js"><link rel="prefetch" href="/assets/js/31.420db076.js"><link rel="prefetch" href="/assets/js/32.227f3c52.js"><link rel="prefetch" href="/assets/js/33.74f30a07.js"><link rel="prefetch" href="/assets/js/34.6800baab.js"><link rel="prefetch" href="/assets/js/35.1364295d.js"><link rel="prefetch" href="/assets/js/36.1f3555c4.js"><link rel="prefetch" href="/assets/js/37.03460d49.js"><link rel="prefetch" href="/assets/js/38.7288c585.js"><link rel="prefetch" href="/assets/js/39.be2cc39a.js"><link rel="prefetch" href="/assets/js/4.69d337f5.js"><link rel="prefetch" href="/assets/js/40.25a2c3c6.js"><link rel="prefetch" href="/assets/js/41.00f9dadf.js"><link rel="prefetch" href="/assets/js/42.5befdd01.js"><link rel="prefetch" href="/assets/js/43.35a181f3.js"><link rel="prefetch" href="/assets/js/44.40ab2e80.js"><link rel="prefetch" href="/assets/js/45.ef5a1522.js"><link rel="prefetch" href="/assets/js/46.933ea0fe.js"><link rel="prefetch" href="/assets/js/47.bdc1d06e.js"><link rel="prefetch" href="/assets/js/48.2a8183d7.js"><link rel="prefetch" href="/assets/js/49.df5b3519.js"><link rel="prefetch" href="/assets/js/5.819c231b.js"><link rel="prefetch" href="/assets/js/50.f6e77e4d.js"><link rel="prefetch" href="/assets/js/51.52640232.js"><link rel="prefetch" href="/assets/js/52.887b891d.js"><link rel="prefetch" href="/assets/js/53.0a327f41.js"><link rel="prefetch" href="/assets/js/54.5855f8f3.js"><link rel="prefetch" href="/assets/js/55.376b3041.js"><link rel="prefetch" href="/assets/js/56.8d2aae84.js"><link rel="prefetch" href="/assets/js/57.945b40cd.js"><link rel="prefetch" href="/assets/js/58.fce6fb60.js"><link rel="prefetch" href="/assets/js/59.efb6444b.js"><link rel="prefetch" href="/assets/js/6.bfb1454e.js"><link rel="prefetch" href="/assets/js/60.721cd48d.js"><link rel="prefetch" href="/assets/js/61.356f751f.js"><link rel="prefetch" href="/assets/js/62.9538717e.js"><link rel="prefetch" href="/assets/js/7.3aae742d.js"><link rel="prefetch" href="/assets/js/8.41a4751c.js"><link rel="prefetch" href="/assets/js/9.45376988.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.5e84523f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.71eccbd5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/feathers-logo-wide.png" alt="xh的博客" class="logo"></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/guides/" class="nav-link">Guides</a></div><div class="nav-item"><a href="/api/" class="nav-link router-link-active">API</a></div><div class="nav-item"><a href="/cookbook/" class="nav-link">Cookbook</a></div><div class="nav-item"><a href="/help/" class="nav-link">Help</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Ecosystem</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/feathersjs/awesome-feathersjs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Awesome Feathersjs
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.youtube.com/playlist?list=PLwSdIiqnDlf_lb5y1liQK2OW5daXYgKOe" target="_blank" rel="noopener noreferrer" class="nav-link external">
  YouTube Playlist
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://vuex.feathersjs.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Feathers VueX
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://hooks-common.feathersjs.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Common Hooks
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><h4>Other versions</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://dove.docs.feathersjs.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Dove (v5, next)
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://buzzard.docs.feathersjs.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Buzzard (v3)
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://auk.docs.feathersjs.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Auk (v2)
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div> <a href="https://github.com/feathersjs/feathers" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/guides/" class="nav-link">Guides</a></div><div class="nav-item"><a href="/api/" class="nav-link router-link-active">API</a></div><div class="nav-item"><a href="/cookbook/" class="nav-link">Cookbook</a></div><div class="nav-item"><a href="/help/" class="nav-link">Help</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Ecosystem</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/feathersjs/awesome-feathersjs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Awesome Feathersjs
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.youtube.com/playlist?list=PLwSdIiqnDlf_lb5y1liQK2OW5daXYgKOe" target="_blank" rel="noopener noreferrer" class="nav-link external">
  YouTube Playlist
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://vuex.feathersjs.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Feathers VueX
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://hooks-common.feathersjs.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Common Hooks
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><h4>Other versions</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://dove.docs.feathersjs.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Dove (v5, next)
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://buzzard.docs.feathersjs.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Buzzard (v3)
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://auk.docs.feathersjs.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Auk (v2)
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div> <a href="https://github.com/feathersjs/feathers" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Core</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/api/application.html" class="sidebar-link">Application</a></li><li><a href="/api/services.html" class="sidebar-link">Services</a></li><li><a href="/api/hooks.html" class="sidebar-link">Hooks</a></li><li><a href="/api/events.html" class="sidebar-link">Events</a></li><li><a href="/api/errors.html" class="sidebar-link">Errors</a></li><li><a href="/api/configuration.html" class="sidebar-link">Configuration</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Transports</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/api/express.html" class="sidebar-link">Express</a></li><li><a href="/api/socketio.html" class="sidebar-link">Socket.io</a></li><li><a href="/api/primus.html" class="sidebar-link">Primus</a></li><li><a href="/api/channels.html" aria-current="page" class="active sidebar-link">Channels</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/api/channels.html#concepts" class="sidebar-link">Concepts</a></li><li class="sidebar-sub-header"><a href="/api/channels.html#example" class="sidebar-link">Example</a></li><li class="sidebar-sub-header"><a href="/api/channels.html#connections" class="sidebar-link">Connections</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/api/channels.html#app-on-connection" class="sidebar-link">app.on('connection')</a></li><li class="sidebar-sub-header"><a href="/api/channels.html#app-on-disconnect" class="sidebar-link">app.on('disconnect')</a></li><li class="sidebar-sub-header"><a href="/api/channels.html#app-on-login" class="sidebar-link">app.on('login')</a></li><li class="sidebar-sub-header"><a href="/api/channels.html#app-on-logout" class="sidebar-link">app.on('logout')</a></li></ul></li><li class="sidebar-sub-header"><a href="/api/channels.html#channels-2" class="sidebar-link">Channels</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/api/channels.html#app-channel-names" class="sidebar-link">app.channel(...names)</a></li><li class="sidebar-sub-header"><a href="/api/channels.html#app-channels" class="sidebar-link">app.channels</a></li><li class="sidebar-sub-header"><a href="/api/channels.html#channel-join-connection" class="sidebar-link">channel.join(connection)</a></li><li class="sidebar-sub-header"><a href="/api/channels.html#channel-leave-connection-fn" class="sidebar-link">channel.leave(connection|fn)</a></li><li class="sidebar-sub-header"><a href="/api/channels.html#channel-filter-fn" class="sidebar-link">channel.filter(fn)</a></li><li class="sidebar-sub-header"><a href="/api/channels.html#channel-send-data" class="sidebar-link">channel.send(data)</a></li><li class="sidebar-sub-header"><a href="/api/channels.html#channel-connections" class="sidebar-link">channel.connections</a></li><li class="sidebar-sub-header"><a href="/api/channels.html#channel-length" class="sidebar-link">channel.length</a></li></ul></li><li class="sidebar-sub-header"><a href="/api/channels.html#publishing" class="sidebar-link">Publishing</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/api/channels.html#service-publish-event-fn" class="sidebar-link">service.publish([event,] fn)</a></li><li class="sidebar-sub-header"><a href="/api/channels.html#app-publish-event-fn" class="sidebar-link">app.publish([event,] fn)</a></li><li class="sidebar-sub-header"><a href="/api/channels.html#publisher-precedence" class="sidebar-link">Publisher precedence</a></li></ul></li><li class="sidebar-sub-header"><a href="/api/channels.html#keeping-channels-updated" class="sidebar-link">Keeping channels updated</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Client</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/api/client.html" class="sidebar-link">Feathers Client</a></li><li><a href="/api/client/rest.html" class="sidebar-link">REST Client</a></li><li><a href="/api/client/socketio.html" class="sidebar-link">Socket.io Client</a></li><li><a href="/api/client/primus.html" class="sidebar-link">Primus Client</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Authentication</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/api/authentication/" class="sidebar-link">Overview</a></li><li><a href="/api/authentication/service.html" class="sidebar-link">Service</a></li><li><a href="/api/authentication/strategy.html" class="sidebar-link">Strategies</a></li><li><a href="/api/authentication/hook.html" class="sidebar-link">Hook</a></li><li><a href="/api/authentication/jwt.html" class="sidebar-link">JWT</a></li><li><a href="/api/authentication/local.html" class="sidebar-link">Local</a></li><li><a href="/api/authentication/oauth.html" class="sidebar-link">OAuth</a></li><li><a href="/api/authentication/client.html" class="sidebar-link">Client</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Databases</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/api/databases/adapters.html" class="sidebar-link">Overview</a></li><li><a href="/api/databases/common.html" class="sidebar-link">Common API</a></li><li><a href="/api/databases/querying.html" class="sidebar-link">Querying</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="content content__default"><h1 id="channels"><a href="#channels" class="header-anchor">#</a> Channels</h1> <p>On a Feathers server with a real-time transport (<a href="/api/socketio.html">Socket.io</a> or <a href="/api/primus.html">Primus</a>) set up, event channels determine which connected clients to send <a href="/api/events.html">real-time events</a> to and how the sent data should look like.</p> <p>This chapter describes:</p> <ul><li><a href="#connections">Real-time Connections</a> and how to access them</li> <li><a href="#channels">Channel usage</a> and how to retrieve, join and leave channels</li> <li><a href="#publishing">Publishing events</a> to channels</li></ul> <blockquote><p><strong>Important:</strong> If you are not using a real-time transport server (e.g. when making a REST only API or using Feathers on the client), channel functionality is not going to be available.</p></blockquote> <p>Some examples where channels are used:</p> <ul><li>Real-time events should only be sent to authenticated users</li> <li>Users should only get updates about messages if they joined a certain chat room</li> <li>Only users in the same organization should receive real-time updates about their data changes</li> <li>Only admins should be notified when new users are created</li> <li>When a user is created, modified or removed, non-admins should only receive a &quot;safe&quot; version of the user object (e.g. only <code>email</code>, <code>id</code> and <code>avatar</code>)</li></ul> <h2 id="concepts"><a href="#concepts" class="header-anchor">#</a> Concepts</h2> <p>When using channels, the server pushes events (such as &quot;created&quot;, &quot;removed&quot; etc. for a particular service) down to its clients via <em>channels</em>. The client doesn’t listen to individual channels directly, but rather subscribes to specific events on services that it is interested in. Those events will only fire on the client if the server pushes data to one or more channels that the client has been added to.</p> <p>You can have any number of channels. This helps to organise how data is sent and to control the volume of data, by not sending things that aren't relevant.</p> <p>When a new client connects, the server explicitly adds that <em>connection</em> to any relevant channels. This is how clients are given access to events that they are allowed to see.</p> <p>The server can also change connection channel membership from time to time, eg before vs after login.</p> <p>The server needs to explicitly <em>publish</em> channels it is interested in sharing with clients before they become available.</p> <h2 id="example"><a href="#example" class="header-anchor">#</a> Example</h2> <p>The example below shows the generated <code>channels.js</code> file illustrating how the different parts fit together:</p> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="javascript" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">app</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> app<span class="token punctuation">.</span>channel <span class="token operator">!==</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// If no real-time functionality has been configured just return</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'connection'</span><span class="token punctuation">,</span> <span class="token parameter">connection</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// On a new real-time connection, add it to the anonymous channel</span>
    app<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token string">'anonymous'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>connection<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'login'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">authResult<span class="token punctuation">,</span> <span class="token punctuation">{</span> connection <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// connection can be undefined if there is no</span>
    <span class="token comment">// real-time connection, e.g. when logging in via REST</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>connection<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Obtain the logged in user from the connection</span>
      <span class="token comment">// const user = connection.user;</span>
      
      <span class="token comment">// The connection is no longer anonymous, remove it</span>
      app<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token string">'anonymous'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">leave</span><span class="token punctuation">(</span>connection<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// Add it to the authenticated user channel</span>
      app<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token string">'authenticated'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>connection<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// Channels can be named anything and joined on any condition </span>
      
      <span class="token comment">// E.g. to send real-time events only to admins use</span>
      <span class="token comment">// if(user.isAdmin) { app.channel('admins').join(connection); }</span>

      <span class="token comment">// If the user has joined e.g. chat rooms</span>
      <span class="token comment">// if(Array.isArray(user.rooms)) user.rooms.forEach(room =&gt; app.channel(`rooms/${room.id}`).join(connection));</span>
      
      <span class="token comment">// Easily organize users by email and userid for things like messaging</span>
      <span class="token comment">// app.channel(`emails/${user.email}`).join(connection);</span>
      <span class="token comment">// app.channel(`userIds/${user.id}`).join(connection);</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// eslint-disable-next-line no-unused-vars</span>
  app<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> hook</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Here you can add event publishers to channels set up in `channels.js`</span>
    <span class="token comment">// To publish only for a specific event use `app.publish(eventname, () =&gt; {})`</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Publishing all events to all authenticated users. See `channels.js` and https://docs.feathersjs.com/api/channels.html for more information.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// eslint-disable-line</span>

    <span class="token comment">// e.g. to publish all service events to all authenticated users use</span>
    <span class="token keyword">return</span> app<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token string">'authenticated'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Here you can also add service specific event publishers</span>
  <span class="token comment">// e.g. the publish the `users` service `created` event to the `admins` channel</span>
  <span class="token comment">// app.service('users').publish('created', () =&gt; app.channel('admins'));</span>
  
  <span class="token comment">// With the userid and email organization from above you can easily select involved users</span>
  <span class="token comment">// app.service('messages').publish(data =&gt; {</span>
  <span class="token comment">//   return [</span>
  <span class="token comment">//     app.channel(`userIds/${data.createdBy}`),</span>
  <span class="token comment">//     app.channel(`emails/${data.recipientEmail}`)</span>
  <span class="token comment">//   ];</span>
  <span class="token comment">// });</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="typescript" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span><span class="token punctuation">(</span>app<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> app<span class="token punctuation">.</span>channel <span class="token operator">!==</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// If no real-time functionality has been configured just return</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'connection'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>connection<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// On a new real-time connection, add it to the anonymous channel</span>
    app<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token string">'anonymous'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>connection<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'login'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>authResult<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> connection <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// connection can be undefined if there is no</span>
    <span class="token comment">// real-time connection, e.g. when logging in via REST</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>connection<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Obtain the logged in user from the connection</span>
      <span class="token comment">// const user = connection.user;</span>
      
      <span class="token comment">// The connection is no longer anonymous, remove it</span>
      app<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token string">'anonymous'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">leave</span><span class="token punctuation">(</span>connection<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// Add it to the authenticated user channel</span>
      app<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token string">'authenticated'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>connection<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// Channels can be named anything and joined on any condition </span>
      
      <span class="token comment">// E.g. to send real-time events only to admins use</span>
      <span class="token comment">// if(user.isAdmin) { app.channel('admins').join(connection); }</span>

      <span class="token comment">// If the user has joined e.g. chat rooms</span>
      <span class="token comment">// if(Array.isArray(user.rooms)) user.rooms.forEach(room =&gt; app.channel(`rooms/${room.id}`).join(connection));</span>
      
      <span class="token comment">// Easily organize users by email and userid for things like messaging</span>
      <span class="token comment">// app.channel(`emails/${user.email}`).join(connection);</span>
      <span class="token comment">// app.channel(`userIds/${user.id}`).join(connection);</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// eslint-disable-next-line no-unused-vars</span>
  app<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token punctuation">(</span>data<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> hook<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Here you can add event publishers to channels set up in `channels.js`</span>
    <span class="token comment">// To publish only for a specific event use `app.publish(eventname, () =&gt; {})`</span>

    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Publishing all events to all authenticated users. See `channels.js` and https://docs.feathersjs.com/api/channels.html for more information.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// eslint-disable-line</span>

    <span class="token comment">// e.g. to publish all service events to all authenticated users use</span>
    <span class="token keyword">return</span> app<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token string">'authenticated'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Here you can also add service specific event publishers</span>
  <span class="token comment">// e.g. the publish the `users` service `created` event to the `admins` channel</span>
  <span class="token comment">// app.service('users').publish('created', () =&gt; app.channel('admins'));</span>
  
  <span class="token comment">// With the userid and email organization from above you can easily select involved users</span>
  <span class="token comment">// app.service('messages').publish(data =&gt; {</span>
  <span class="token comment">//   return [</span>
  <span class="token comment">//     app.channel(`userIds/${data.createdBy}`),</span>
  <span class="token comment">//     app.channel(`emails/${data.recipientEmail}`)</span>
  <span class="token comment">//   ];</span>
  <span class="token comment">// });</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h2 id="connections"><a href="#connections" class="header-anchor">#</a> Connections</h2> <p>A connection is an object that represents a real-time connection. It is the same object as <code>socket.feathers</code> in a <a href="/api/socketio.html">Socket.io</a> and <code>socket.request.feathers</code> in a <a href="/api/primus.html">Primus</a> middleware. You can add any kind of information to it but most notably, when using <a href="/api/authentication/service.html">authentication</a>, it will contain the authenticated user. By default it is located in <code>connection.user</code> once the client has authenticated on the socket (usually by calling <code>app.authenticate()</code> on the <a href="/api/client.html">client</a>).</p> <p>We can get access to the <code>connection</code> object by listening to <code>app.on('connection', connection =&gt; {})</code> or <code>app.on('login', (payload, { connection }) =&gt; {})</code>.</p> <blockquote><p><strong>Note:</strong> When a connection is terminated it will be automatically removed from all channels.</p></blockquote> <h3 id="app-on-connection"><a href="#app-on-connection" class="header-anchor">#</a> app.on('connection')</h3> <p><code>app.on('connection', connection =&gt; {})</code> is fired every time a new real-time connection is established. This is a good place to add the connection to a channel for anonymous users (in case we want to send any real-time updates to them):</p> <div class="language-js extra-class"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'connection'</span><span class="token punctuation">,</span> <span class="token parameter">connection</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// On a new real-time connection, add it to the</span>
  <span class="token comment">// anonymous channel</span>
  app<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token string">'anonymous'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>connection<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="app-on-disconnect"><a href="#app-on-disconnect" class="header-anchor">#</a> app.on('disconnect')</h3> <p><code>app.on('disconnect', connection =&gt; {})</code> is fired every time real-time connection is disconnected. This is a good place to to handle disconnections outside of a logout. A connection that is disconnected will always leave all its channels automatically.</p> <h3 id="app-on-login"><a href="#app-on-login" class="header-anchor">#</a> app.on('login')</h3> <p><code>app.on('login', (authResult, params, context) =&gt; {})</code> is sent by the <a href="/api/authentication/service.html#app-on-login">AuthenticationService</a> on successful login.</p> <p>This is a good place to add the connection to channels related to the user (e.g. chat rooms, admin status etc.)</p> <div class="language-js extra-class"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'login'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">payload<span class="token punctuation">,</span> <span class="token punctuation">{</span> connection <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// connection can be undefined if there is no</span>
  <span class="token comment">// real-time connection, e.g. when logging in via REST</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>connection<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// The user attached to this connection</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> user <span class="token punctuation">}</span> <span class="token operator">=</span> connection<span class="token punctuation">;</span>

    <span class="token comment">// The connection is no longer anonymous, remove it</span>
    app<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token string">'anonymous'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">leave</span><span class="token punctuation">(</span>connection<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Add it to the authenticated user channel</span>
    app<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token string">'authenticated'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>connection<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Channels can be named anything and joined on any condition `</span>
    <span class="token comment">// E.g. to send real-time events only to admins use</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>isAdmin<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      app<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token string">'admins'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>connection<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// If the user has joined e.g. chat rooms</span>
    user<span class="token punctuation">.</span>rooms<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">room</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      app<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">rooms/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>room<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>connection<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="app-on-logout"><a href="#app-on-logout" class="header-anchor">#</a> app.on('logout')</h3> <p><code>app.on('logout', (authResult, params, context) =&gt; {})</code> is sent by the <a href="/api/authentication/service.html">AuthenticationService</a> on successful logout:</p> <div class="language-js extra-class"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'logout'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">payload<span class="token punctuation">,</span> <span class="token punctuation">{</span> connection <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>connection<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Join the channels a logged out connection should be in</span>
    app<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token string">'anonymous'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>connection<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p><strong>Note:</strong> On <code>logout</code> the connection will be removed from all existing channels automatically.</p></blockquote> <h2 id="channels-2"><a href="#channels-2" class="header-anchor">#</a> Channels</h2> <p>A channel is an object that contains a number of connections. It can be created via <code>app.channel</code> and allows a connection to join or leave it.</p> <h3 id="app-channel-names"><a href="#app-channel-names" class="header-anchor">#</a> app.channel(...names)</h3> <p><code>app.channel(name) -&gt; Channel</code>, when given a single name, returns an existing or new named channel:</p> <div class="language-js extra-class"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token string">'admins'</span><span class="token punctuation">)</span> <span class="token comment">// the admin channel</span>
app<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token string">'authenticated'</span><span class="token punctuation">)</span> <span class="token comment">// the authenticated channel</span>
</code></pre></div><p><code>app.channel(name1, name2, ... nameN) -&gt; Channel</code>, when given multiples names, will return a combined channel. A combined channel contains a list of all connections (without duplicates) and re-directs <code>channel.join</code> and <code>channel.leave</code> calls to all its child channels.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Combine the anonymous and authenticated channel</span>
<span class="token keyword">const</span> combinedChannel <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token string">'anonymous'</span><span class="token punctuation">,</span> <span class="token string">'authenticated'</span><span class="token punctuation">)</span>

<span class="token comment">// Join the `anonymous` and `authenticated` channel</span>
combinedChannel<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>connection<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Join the `admins` and `chat` channel</span>
app<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token string">'admins'</span><span class="token punctuation">,</span> <span class="token string">'chat'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>connection<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Leave the `admins` and `chat` channel</span>
app<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token string">'admins'</span><span class="token punctuation">,</span> <span class="token string">'chat'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">leave</span><span class="token punctuation">(</span>connection<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Make user with `_id` 5 leave the admins and chat channel</span>
app<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token string">'admins'</span><span class="token punctuation">,</span> <span class="token string">'chat'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">leave</span><span class="token punctuation">(</span><span class="token parameter">connection</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> connection<span class="token punctuation">.</span>user<span class="token punctuation">.</span>_id <span class="token operator">===</span> <span class="token number">5</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="app-channels"><a href="#app-channels" class="header-anchor">#</a> app.channels</h3> <p><code>app.channels -&gt; [string]</code> returns a list of all existing channel names.</p> <div class="language-js extra-class"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token string">'authenticated'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token string">'admins'</span><span class="token punctuation">,</span> <span class="token string">'users'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span>channels <span class="token comment">// [ 'authenticated', 'admins', 'users' ]</span>

app<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>channels<span class="token punctuation">)</span> <span class="token comment">// will return a channel with all connections</span>
</code></pre></div><p>This is useful to e.g. remove a connection from all channels:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// When a user is removed, make all their connections leave every channel</span>
app<span class="token punctuation">.</span><span class="token function">service</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'removed'</span><span class="token punctuation">,</span> <span class="token parameter">user</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  app<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>channels<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">leave</span><span class="token punctuation">(</span><span class="token parameter">connection</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> user<span class="token punctuation">.</span>_id <span class="token operator">===</span> connection<span class="token punctuation">.</span>user<span class="token punctuation">.</span>_id<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="channel-join-connection"><a href="#channel-join-connection" class="header-anchor">#</a> channel.join(connection)</h3> <p><code>channel.join(connection) -&gt; Channel</code> adds a connection to this channel. If the channel is a combined channel, add the connection to all its child channels. If the connection is already in the channel it does nothing. Returns the channel object.</p> <div class="language-js extra-class"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'login'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">payload<span class="token punctuation">,</span> <span class="token punctuation">{</span> connection <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>connection <span class="token operator">&amp;&amp;</span> connection<span class="token punctuation">.</span>user<span class="token punctuation">.</span>isAdmin<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Join the admins channel</span>
    app<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token string">'admins'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>connection<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Calling a second time will do nothing</span>
    app<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token string">'admins'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>connection<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="channel-leave-connection-fn"><a href="#channel-leave-connection-fn" class="header-anchor">#</a> channel.leave(connection|fn)</h3> <p><code>channel.leave(connection|fn) -&gt; Channel</code> removes a connection from this channel. If the channel is a combined channel, remove the connection from all its child channels. Also allows to pass a callback that is run for every connection and returns if the connection should be removed or not. Returns the channel object.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Make the user with `_id` 5 leave the `admins` channel</span>
app<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token string">'admins'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">leave</span><span class="token punctuation">(</span><span class="token parameter">connection</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> connection<span class="token punctuation">.</span>user<span class="token punctuation">.</span>_id <span class="token operator">===</span> <span class="token number">5</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="channel-filter-fn"><a href="#channel-filter-fn" class="header-anchor">#</a> channel.filter(fn)</h3> <p><code>channel.filter(fn) -&gt; Channel</code> returns a new channel filtered by a given function which gets passed the connection.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Returns a new channel with all connections of the user with `_id` 5</span>
<span class="token keyword">const</span> userFive <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>channels<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">connection</span> <span class="token operator">=&gt;</span> connection<span class="token punctuation">.</span>user<span class="token punctuation">.</span>_id <span class="token operator">===</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="channel-send-data"><a href="#channel-send-data" class="header-anchor">#</a> channel.send(data)</h3> <p><code>channel.send(data) -&gt; Channel</code> returns a copy of this channel with customized data that should be sent for this event. Usually this should be handled by modifying either the service method result or setting client &quot;safe&quot; data in <code>context.dispatch</code> but in some cases it might make sense to still change the event data for certain channels.</p> <p>What data will be sent as the event data will be determined by the first available in the following order:</p> <ol><li><code>data</code> from <code>channel.send(data)</code></li> <li><code>context.dispatch</code></li> <li><code>context.result</code></li></ol> <div class="language-js extra-class"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'connection'</span><span class="token punctuation">,</span> <span class="token parameter">connection</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// On a new real-time connection, add it to the</span>
  <span class="token comment">// anonymous channel</span>
  app<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token string">'anonymous'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>connection<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Send the `users` `created` event to all anonymous</span>
<span class="token comment">// users but use only the name as the payload</span>
app<span class="token punctuation">.</span><span class="token function">service</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token string">'created'</span><span class="token punctuation">,</span> <span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> app<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token string">'anonymous'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> data<span class="token punctuation">.</span>name
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p><strong>Note:</strong> If a connection is in multiple channels (e.g. <code>users</code> and <code>admins</code>) it will get the data from the <em>first</em> channel that it is in.</p></blockquote> <h3 id="channel-connections"><a href="#channel-connections" class="header-anchor">#</a> channel.connections</h3> <p><code>channel.connections -&gt; [ object ]</code> contains a list of all connections in this channel.</p> <h3 id="channel-length"><a href="#channel-length" class="header-anchor">#</a> channel.length</h3> <p><code>channel.length -&gt; integer</code> returns the total number of connections in this channel.</p> <h2 id="publishing"><a href="#publishing" class="header-anchor">#</a> Publishing</h2> <p>Publishers are callback functions that return which channel(s) to send an event to. They can be registered at the application and the service level and for all or specific events. A publishing function gets the event data and context object (<code>(data, context) =&gt; {}</code>) and returns a named or combined channel, an array of channels or <code>null</code>. Only one publisher can be registered for one type. Besides the standard <a href="/api/events.html#service-events">service event names</a> an event name can also be a <a href="/api/events.html#custom-events">custom event</a>. <code>context</code> is the <a href="/api/hooks.html">context object</a> from the service call or an object containing <code>{ path, service, app, result }</code> for custom events.</p> <h3 id="service-publish-event-fn"><a href="#service-publish-event-fn" class="header-anchor">#</a> service.publish([event,] fn)</h3> <p><code>service.publish([event,] fn) -&gt; service</code> registers a publishing function for a specific service for a specific event or all events if no event name was given.</p> <div class="language-js extra-class"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'login'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">payload<span class="token punctuation">,</span> <span class="token punctuation">{</span> connection <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// connection can be undefined if there is no</span>
  <span class="token comment">// real-time connection, e.g. when logging in via REST</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>connection <span class="token operator">&amp;&amp;</span> connection<span class="token punctuation">.</span>user<span class="token punctuation">.</span>isAdmin<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    app<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token string">'admins'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>connection<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Publish all messages service events only to its room channel</span>
app<span class="token punctuation">.</span><span class="token function">service</span><span class="token punctuation">(</span><span class="token string">'messages'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> app<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">rooms/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token punctuation">.</span>roomId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Publish the `created` event to admins and the user that sent it</span>
app<span class="token punctuation">.</span><span class="token function">service</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token string">'created'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span>
    app<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token string">'admins'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    app<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>channels<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">connection</span> <span class="token operator">=&gt;</span>
      connection<span class="token punctuation">.</span>user<span class="token punctuation">.</span>_id <span class="token operator">===</span> context<span class="token punctuation">.</span>params<span class="token punctuation">.</span>user<span class="token punctuation">.</span>_id
    <span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Prevent all events in the `password-reset` service from being published</span>
app<span class="token punctuation">.</span><span class="token function">service</span><span class="token punctuation">(</span><span class="token string">'password-reset'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="app-publish-event-fn"><a href="#app-publish-event-fn" class="header-anchor">#</a> app.publish([event,] fn)</h3> <p><code>app.publish([event,] fn) -&gt; app</code> registers a publishing function for all services for a specific event or all events if no event name was given.</p> <div class="language-js extra-class"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'login'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">payload<span class="token punctuation">,</span> <span class="token punctuation">{</span> connection <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// connection can be undefined if there is no</span>
  <span class="token comment">// real-time connection, e.g. when logging in via REST</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>connection<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    app<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token string">'authenticated'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>connection<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Publish all events to all authenticated users</span>
app<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> app<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token string">'authenticated'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Publish the `log` custom event to all connections</span>
app<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token string">'log'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> app<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>channels<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="publisher-precedence"><a href="#publisher-precedence" class="header-anchor">#</a> Publisher precedence</h3> <p>The first publisher callback found in the following order will be used:</p> <ol><li>Service publisher for a specific event</li> <li>Service publisher for all events</li> <li>App publishers for a specific event</li> <li>App publishers for all events</li></ol> <h2 id="keeping-channels-updated"><a href="#keeping-channels-updated" class="header-anchor">#</a> Keeping channels updated</h2> <p>Since every application will be different, keeping the connections assigned to channels up to date (e.g. if a user joins/leaves a room) is up to you.</p> <p>In general, channels should reflect your persistent application data. This means that it normally isn't necessary for e.g. a user to request to directly join a channel. This is especially important when running multiple instances of an application since channels are only <em>local</em> to the current instance.</p> <p>Instead, the relevant information (e.g. what rooms a user is currently in) should be stored in the database and then the active connections can be re-distributed into the appropriate channels listening to the proper <a href="/api/events.html">service events</a>.</p> <p>The following example updates all active connections for a given user when the user object (which is assumed to have a <code>rooms</code> array being a list of room ids the user has joined) is updated or removed:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Join a channel given a user and connection</span>
<span class="token keyword">const</span> <span class="token function-variable function">joinChannels</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">user<span class="token punctuation">,</span> connection</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  app<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token string">'authenticated'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>connection<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// Assuming that the chat room/user assignment is stored</span>
  <span class="token comment">// on an array of the user</span>
  user<span class="token punctuation">.</span>rooms<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">room</span> <span class="token operator">=&gt;</span>
    app<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">rooms/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>roomId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>connection<span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Get a user to leave all channels</span>
<span class="token keyword">const</span> <span class="token function-variable function">leaveChannels</span> <span class="token operator">=</span> <span class="token parameter">user</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  app<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>channels<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">leave</span><span class="token punctuation">(</span><span class="token parameter">connection</span> <span class="token operator">=&gt;</span>
    connection<span class="token punctuation">.</span>user<span class="token punctuation">.</span>_id <span class="token operator">===</span> user<span class="token punctuation">.</span>_id
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Leave and re-join all channels with new user information</span>
<span class="token keyword">const</span> <span class="token function-variable function">updateChannels</span> <span class="token operator">=</span> <span class="token parameter">user</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Find all connections for this user</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> connections <span class="token punctuation">}</span> <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>channels<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">connection</span> <span class="token operator">=&gt;</span>
    connection<span class="token punctuation">.</span>user<span class="token punctuation">.</span>_id <span class="token operator">===</span> user<span class="token punctuation">.</span>_id
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Leave all channels</span>
  <span class="token function">leaveChannels</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Re-join all channels with the updated user information</span>
  connections<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">connection</span> <span class="token operator">=&gt;</span> <span class="token function">joinChannels</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> connection<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'login'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">payload<span class="token punctuation">,</span> <span class="token punctuation">{</span> connection <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>connection<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Join all channels on login</span>
    <span class="token function">joinChannels</span><span class="token punctuation">(</span>connection<span class="token punctuation">.</span>user<span class="token punctuation">,</span> connection<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// On `updated` and `patched`, leave and re-join with new room assignments</span>
app<span class="token punctuation">.</span><span class="token function">service</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'updated'</span><span class="token punctuation">,</span> updateChannels<span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">service</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'patched'</span><span class="token punctuation">,</span> updateChannels<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// On `removed`, remove the connection from all channels</span>
app<span class="token punctuation">.</span><span class="token function">service</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'removed'</span><span class="token punctuation">,</span> leaveChannels<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p><strong>Note:</strong> The number active connections is usually one (or none) but unless you prevent it explicitly Feathers is not preventing multiple logins of the same user (e.g. with two open browser windows or on a mobile device).</p></blockquote></div> <footer class="page-edit"><blockquote><p>
        Anything unclear or missing?
        <a href="/help" rel="noopener noreferrer">
          Get help
        </a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span> or <a href="https://github.com/feathersjs/docs/edit/crow/api/channels.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></p> <small><span class="prefix">Last Updated: </span> <span class="time">5/25/2020, 11:23:08 PM</span></small></blockquote></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/api/primus.html" class="prev">
          Primus
        </a></span> <span class="next"><a href="/api/client.html">
          Feathers Client
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.f4b1d533.js" defer></script><script src="/assets/js/3.7ef197bc.js" defer></script><script src="/assets/js/25.ce1df76d.js" defer></script>
  </body>
</html>
