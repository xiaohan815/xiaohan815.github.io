(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1dbda474","chunk-2e6d1b12"],{2883:function(e,t,o){"use strict";o.d(t,"b",(function(){return n})),o.d(t,"a",(function(){return a}));var n={border:!0,card:!0,index:!0,indexLabel:"序号",stripe:!0,menu:!0,menuAlign:"center",filterBtn:!1,menuWidth:300,align:"center",viewBtn:!1,editBtn:!1,delBtn:!1,addBtn:!1,searchMenuSpan:6,dialogWidth:"85%",labelWidth:130,dialogHeight:"78%",column:[{label:"jobId",prop:"jobId",hide:!0,addDisplay:!1,editDisplay:!1,rules:[{required:!0,message:"请输入任务类型",trigger:"blur"}]},{label:"任务名称",prop:"jobName",search:!0,placeholder:"任务名称",rules:[{required:!0,message:"请输入任务名称",trigger:"blur"}],editDisabled:!0},{label:"任务组名",prop:"jobGroup",search:!0,rules:[{required:!0,message:"请输入任务组名",trigger:"blur"}],editDisabled:!0},{label:"任务状态",prop:"jobStatus",type:"select",dicUrl:"/admin/dict/type/job_status",addDisplay:!1,search:!0,slot:!0},{label:"执行状态",prop:"jobExecuteStatus",type:"select",dicUrl:"/admin/dict/type/job_execute_status",addDisplay:!1,search:!0,slot:!0},{label:"创建者",prop:"createBy",hide:!0,addDisplay:!1,editDisplay:!1},{label:"创建时间",prop:"createTime",type:"datetime",hide:!0,format:"yyyy-MM-dd HH:mm:ss",valueFormat:"yyyy-MM-dd HH:mm:ss",width:120,addDisplay:!1,editDisplay:!1},{label:"更新者",prop:"updateBy",hide:!0,addDisplay:!1,editDisplay:!1},{label:"更新时间",prop:"updateTime",type:"datetime",hide:!0,format:"yyyy-MM-dd HH:mm:ss",valueFormat:"yyyy-MM-dd HH:mm:ss",width:160,addDisplay:!1,editDisplay:!1},{label:"首次执行时间",prop:"startTime",type:"datetime",format:"yyyy-MM-dd HH:mm:ss",valueFormat:"yyyy-MM-dd HH:mm:ss",width:160,addDisplay:!1,editDisabled:!0},{label:"上次执行时间",prop:"previousTime",type:"datetime",format:"yyyy-MM-dd HH:mm:ss",valueFormat:"yyyy-MM-dd HH:mm:ss",width:160,addDisplay:!1,editDisabled:!0},{label:"下次执行时间",prop:"nextTime",type:"datetime",format:"yyyy-MM-dd HH:mm:ss",valueFormat:"yyyy-MM-dd HH:mm:ss",width:160,addDisplay:!1,editDisabled:!0},{label:"组内顺序",prop:"jobOrder",hide:!0,addDisplay:!1,editDisplay:!1,type:"silder",step:1,min:1,max:9,showStops:!0},{label:"类型",prop:"jobType",type:"select",dicUrl:"/admin/dict/type/job_type",width:100,rules:[{required:!0,message:"请输入任务类型",trigger:"blur"}]},{label:"执行路径",prop:"executePath",overHidden:!0},{label:"执行文件",prop:"className",overHidden:!0},{label:"执行方法",prop:"methodName",overHidden:!0,width:120},{label:"执行参数值",prop:"methodParamsValue",width:100,overHidden:!0},{label:"cron表达式",prop:"cronExpression",width:100,formslot:!0,rules:[{required:!0,max:200,message:"请输入cron表达式",trigger:"change"}]},{label:"错失执行策略",prop:"misfirePolicy",type:"select",dicUrl:"/admin/dict/type/misfire_policy",width:120,rules:[{required:!0,message:"请输入任务错失执行策略",trigger:"blur"}]},{label:"租户",prop:"tenantId",hide:!0,addDisplay:!1,editDisplay:!1},{label:"备注信息",prop:"remark",type:"textarea",span:20,overHidden:!0,rules:[{max:500,message:"备注信息不得超过500",trigger:"blur"}]}]},a={border:!0,index:!1,menu:!1,page:!0,indexLabel:"序号",stripe:!0,filterBtn:!1,editBtn:!1,delBtn:!1,addBtn:!1,searchMenuSpan:6,columnBtn:!1,column:[{label:"id",prop:"jobLogId",hide:!0},{label:"任务id",prop:"jobId",hide:!0},{label:"任务名称",prop:"jobName"},{label:"任务组名",prop:"jobGroup"},{label:"状态",prop:"jobLogStatus",type:"select",dicUrl:"/admin/dict/type/job_execute_status"},{label:"组内顺序",prop:"jobOrder",hide:!0},{label:"类型",prop:"jobType",type:"select",dicUrl:"/admin/dict/type/job_type",width:100},{label:"执行路径",prop:"executePath",overHidden:!0},{label:"执行文件",prop:"className",overHidden:!0},{label:"执行方法",prop:"methodName",overHidden:!0,width:120},{label:"执行参数值",prop:"methodParamsValue",width:100,overHidden:!0},{label:"cron表达式",prop:"cronExpression",width:100,overHidden:!0},{label:"状态描述",prop:"jobMessage"},{label:"执行时间(ms)",prop:"executeTime",width:120},{label:"异常信息",prop:"exceptionInfo",overHidden:!0},{label:"开始时间",prop:"createTime",type:"datetime",format:"yyyy-MM-dd HH:mm:ss",valueFormat:"yyyy-MM-dd HH:mm:ss",width:160}]}},"3de3":function(e,t,o){"use strict";o.d(t,"c",(function(){return a})),o.d(t,"d",(function(){return i})),o.d(t,"j",(function(){return r})),o.d(t,"l",(function(){return s})),o.d(t,"g",(function(){return c})),o.d(t,"k",(function(){return u})),o.d(t,"h",(function(){return d})),o.d(t,"i",(function(){return l})),o.d(t,"a",(function(){return b})),o.d(t,"b",(function(){return p})),o.d(t,"f",(function(){return h})),o.d(t,"e",(function(){return f}));var n=o("b775");function a(e){return Object(n["default"])({url:"/job/sys-job/page",method:"get",params:e})}function i(e){return Object(n["default"])({url:"/job/sys-job/job-log",method:"get",params:e})}function r(){return Object(n["default"])({url:"/job/sys-job/shutdown-jobs",method:"post"})}function s(){return Object(n["default"])({url:"/job/sys-job/start-jobs",method:"post"})}function c(){return Object(n["default"])({url:"/job/sys-job/refresh-jobs",method:"post"})}function u(e){return Object(n["default"])({url:"/job/sys-job/start-job/"+e,method:"post"})}function d(e){return Object(n["default"])({url:"/job/sys-job/run-job/"+e,method:"post"})}function l(e){return Object(n["default"])({url:"/job/sys-job/shutdown-job/"+e,method:"post"})}function b(e){return Object(n["default"])({url:"/job/sys-job",method:"post",data:e})}function p(e){return Object(n["default"])({url:"/job/sys-job/"+e,method:"delete"})}function h(e){return Object(n["default"])({url:"/job/sys-job",method:"put",data:e})}function f(e){return Object(n["default"])({url:"/job/sys-job/is-valid-task-name",method:"get",params:e})}},"7368d":function(e,t,o){"use strict";o.r(t);var n=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"jobLog"},[o("basic-container",[o("el-dialog",{attrs:{visible:e.dialogFormVisible,title:"执行日志",width:"90%"},on:{"update:visible":function(t){e.dialogFormVisible=t},close:e.closeJobLogDialog}},[o("avue-crud",{ref:"crudLog",attrs:{page:e.pageLog,data:e.tableLogData,option:e.tableLogOption,"table-loading":e.tableLogLoading},on:{"on-load":e.getJobLogList,"size-change":e.sizeChange,"current-change":e.currentChange,"refresh-change":e.getJobLogList}})],1)],1)],1)},a=[],i=o("5530"),r=o("3de3"),s=o("2883"),c=o("2f62"),u={name:"jobLog",data:function(){return{tableLogData:[],dialogFormVisible:!1,jobId:"",pageLog:{total:0,currentPage:1,pageSize:10},tableLogLoading:!1,tableLogOption:s["a"]}},computed:Object(i["a"])({},Object(c["mapGetters"])(["permissions"])),mounted:function(){},methods:{init:function(){this.dialogFormVisible=!0,this.getJobLogList(this.pageLog)},getJobLog:function(e){this.dialogFormVisible=!0,this.tableLogLoading=!0,this.jobId=e.jobId,this.getJobLogList(this.pageLog)},getJobLogList:function(e){var t=this;Object(r["d"])(Object.assign({descs:"create_time",current:e.currentPage,size:e.pageSize},{jobId:this.jobId})).then((function(e){t.tableLogData=e.data.records,t.pageLog.total=e.data.total,t.pageLog.pageSize=e.data.pageSize,t.tableLogLoading=!1}))},sizeChange:function(e){this.page.pageSize=e},currentChange:function(e){this.page.currentPage=e},closeJobLogDialog:function(){this.jobId="",this.pageLog.total=0,this.pageLog.currentPage=1,this.pageLog.pageSize=10}}},d=u,l=o("2877"),b=Object(l["a"])(d,n,a,!1,null,null,null);t["default"]=b.exports},bf4e:function(e,t,o){"use strict";o.r(t);var n=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"jobIndex"},[o("basic-container",[o("avue-crud",{ref:"crud",attrs:{page:e.page,data:e.tableData,"table-loading":e.tableLoading,option:e.tableOption},on:{"on-load":e.getList,"row-save":e.save,"row-update":e.update,"refresh-change":e.refreshChange,"size-change":e.sizeChange,"current-change":e.currentChange,"search-change":e.handleFilter,"search-reset":e.handleSearchReset},scopedSlots:e._u([{key:"jobStatus",fn:function(t){return["1"===t.row.jobStatus?o("div",[o("el-tag",{attrs:{type:"info"}},[e._v(e._s(e.getDicNameJobStatus(t.row.jobStatus)))])],1):"2"===t.row.jobStatus?o("div",[o("el-tag",{attrs:{type:"success"}},[e._v(e._s(e.getDicNameJobStatus(t.row.jobStatus)))])],1):"3"===t.row.jobStatus?o("div",[o("el-tag",{attrs:{type:"danger"}},[e._v(e._s(e.getDicNameJobStatus(t.row.jobStatus)))])],1):e._e()]}},{key:"jobExecuteStatus",fn:function(t){return["0"===t.row.jobExecuteStatus?o("div",[o("el-tag",{attrs:{type:"success"}},[e._v(e._s(e.getDicNameJobExecuteStatus(t.row.jobExecuteStatus)))])],1):o("div",[o("el-tag",{attrs:{type:"danger"}},[e._v(e._s(e.getDicNameJobExecuteStatus(t.row.jobExecuteStatus)))])],1)]}},{key:"cronExpressionForm",fn:function(t){return[o("div",{staticClass:"cron"},[o("el-popover",{model:{value:e.cronPopover,callback:function(t){e.cronPopover=t},expression:"cronPopover"}},[o("cron",{attrs:{i18n:"cn"},on:{change:e.changeCron,close:function(t){e.cronPopover=!1}}}),e._v(" "),o("el-input",{attrs:{slot:"reference",placeholder:"请输入定时策略"},on:{click:function(t){e.cronPopover=!0}},slot:"reference",model:{value:e.form.cronExpression,callback:function(t){e.$set(e.form,"cronExpression",t)},expression:"form.cronExpression"}})],1)],1)]}},{key:"menu",fn:function(t){return[o("el-button",{attrs:{type:"text",icon:"el-icon-info"},on:{click:function(o){return e.handleJobLog(t.row)}}},[e._v("日志\n        ")]),e._v(" "),e.permissions.job_sys_job_start_job?o("el-button",{attrs:{type:"text",icon:"el-icon-caret-right"},on:{click:function(o){return e.handleStartJob(t.row)}}},[e._v("启动\n        ")]):e._e(),e._v(" "),e.permissions.job_sys_job_shutdown_job?o("el-button",{attrs:{type:"text",icon:"el-icon-error"},on:{click:function(o){return e.handleShutDownJob(t.row)}}},[e._v("暂停\n        ")]):e._e(),e._v(" "),e.permissions.job_sys_job_edit?o("el-button",{attrs:{type:"text",icon:"el-icon-edit"},on:{click:function(o){return e.handleUpdate(t.row,t.index)}}},[e._v("修改\n        ")]):e._e(),e._v(" "),e.permissions.job_sys_job_run_job?o("el-button",{attrs:{type:"text",icon:"el-icon-s-promotion"},on:{click:function(o){return e.handleRunJob(t.row)}}},[e._v("执行\n        ")]):e._e(),e._v(" "),e.permissions.job_sys_job_del?o("el-button",{attrs:{type:"text",icon:"el-icon-delete"},on:{click:function(o){return e.handleDelete(t.row,t.index)}}},[e._v("删除\n        ")]):e._e()]}}]),model:{value:e.form,callback:function(t){e.form=t},expression:"form"}},[e._v(" "),e._v(" "),e._v(" "),o("template",{slot:"menuLeft"},[e.permissions.job_sys_job_add?o("el-button",{attrs:{type:"primary"},on:{click:e.handleAdd}},[e._v("\n          新建任务\n        ")]):e._e(),e._v(" "),o("el-tooltip",{attrs:{content:"暂停全部运行状态的定时任务",placement:"top"}},[e.permissions.job_sys_job_shutdown_job?o("el-button",{attrs:{type:"warning"},on:{click:e.shutdownJobs}},[e._v("\n            暂停全部任务\n          ")]):e._e()],1),e._v(" "),o("el-tooltip",{attrs:{content:"启动全部暂停状态的定时任务",placement:"top"}},[e.permissions.job_sys_job_start_job?o("el-button",{attrs:{type:"success"},on:{click:e.startJobs}},[e._v("\n            启动全部任务\n          ")]):e._e()],1),e._v(" "),o("el-tooltip",{attrs:{content:"谨慎使用",placement:"top"}},[e.permissions.job_sys_job_refresh_job?o("el-button",{attrs:{type:"danger"},on:{click:e.refreshJobs}},[e._v("重置全部任务\n          ")]):e._e()],1)],1)],2)],1),e._v(" "),e.dialogFormVisible?o("jobLog",{ref:"logRef"}):e._e()],1)},a=[],i=(o("ac6a"),o("5530")),r=o("3de3"),s=o("2883"),c=o("59fb"),u=o("2f62"),d=o("117d"),l=o("7368d"),b={name:"jobIndex",components:{cron:d["cron"],jobLog:l["default"]},data:function(){return{form:{},cronPopover:!1,queryParams:{},tableData:[],dialogFormVisible:!1,jobId:"",page:{total:0,currentPage:1,pageSize:10},tableLoading:!1,tableOption:s["b"],JobExecuteStatusDicCache:[],JobStatusDicCache:[]}},computed:Object(i["a"])({},Object(u["mapGetters"])(["permissions"])),mounted:function(){this.getDicJobExecuteStatusCache("job_execute_status"),this.getDicJobStatusCache("job_status")},methods:{changeCron:function(e){this.form.cronExpression=e},getList:function(){var e=this;this.tableLoading=!0,Object(r["c"])(Object.assign({descs:"create_time",current:this.page.currentPage,size:this.page.pageSize},this.queryParams)).then((function(t){e.tableData=t.data.records,e.page.pageSize=t.data.pageSize,e.page.total=t.data.total,e.tableLoading=!1}))},handleSearchReset:function(){this.queryParams={}},handleFilter:function(e,t){this.queryParams=e,this.getList(this.page),t()},handleStartJob:function(e){var t=this,o=e.jobStatus;"1"===o||"3"===o?this.$confirm("即将发布或启动(任务名称:"+e.jobName+"), 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(r["k"])(e.jobId).then((function(e){var o=e.data.code;0===o&&(t.$notify({title:"成功",message:"启动成功",type:"success"}),t.refreshChange())})).catch((function(){t.$notify.error({title:"错误",message:"启动失败"})}))})):this.$notify.error({title:"错误",message:"定时任务已运行"})},handleRunJob:function(e){var t=this;this.$confirm("立刻执行一次任务(任务名称:"+e.jobName+"), 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(r["h"])(e.jobId).then((function(e){var o=e.data.code;0===o&&(t.$notify({title:"成功",message:"执行成功",type:"success"}),t.refreshChange())})).catch((function(){t.$notify.error({title:"错误",message:"执行失败"})}))}))},handleAdd:function(){this.$refs.crud.rowAdd()},handleUpdate:function(e,t){var o=e.jobStatus;"1"===o||"3"===o?this.$refs.crud.rowEdit(e,t):this.$notify.error({title:"错误",message:"运行中定时任务不可修改，请先暂停后操作"})},handleShutDownJob:function(e){var t=this,o=e.jobStatus;"2"===o?this.$confirm("即将暂停(任务名称:"+e.jobName+"), 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(r["i"])(e.jobId).then((function(e){var o=e.data.code;0===o&&(t.getList(t.page),t.$notify({title:"成功",message:"暂停成功",type:"success"})),t.refreshChange()})).catch((function(){t.$notify.error({title:"错误",message:"暂停失败"})}))})):this.$notify.error({title:"错误",message:"已暂停，不要重复操作"})},refreshChange:function(){this.getList(this.page)},sizeChange:function(e){this.page.pageSize=e},currentChange:function(e){this.page.currentPage=e},shutdownJobs:function(){var e=this;this.$confirm("即将暂停全部运行中定时任务, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(r["j"])().then((function(t){var o=t.data.code,n=t.data.msg;0===o?(e.getList(e.page),e.$notify.success(n)):e.$notify.error("暂停失败")})).catch((function(){e.$notify.error("暂停失败")}))}))},startJobs:function(){var e=this;this.$confirm("即将启动全部暂定中定时任务, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(r["l"])().then((function(t){var o=t.data.code;0===o?(e.getList(e.page),e.$notify.success("启动成功")):e.$notify.error("启动失败")})).catch((function(){e.$notify.error("启动失败")}))}))},refreshJobs:function(){var e=this;this.$confirm("即将刷新全部定时任务, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(r["g"])().then((function(t){var o=t.data.code;0===o?(e.getList(e.page),e.$notify.success("重置成功")):e.$notify.error("重置失败")})).catch((function(){e.$notify.error("重置失败")}))}))},save:function(e,t,o){var n=this;Object(r["e"])({jobName:e.jobName,jobGroup:e.jobGroup}).then((function(a){var i=a.data.code;0!==i?n.$notify.error("任务名称与任务组重复，请确认后重新添加"):Object(r["a"])(e).then((function(){n.$notify.success("创建成功"),n.getList(n.page)})).catch((function(){o()})),t()}))},update:function(e,t,o,n){var a=this;Object(r["f"])(e).then((function(){a.getList(a.page),o(),a.$notify.success("修改成功")})).catch((function(){n()}))},handleDelete:function(e){var t=this,o=e.jobStatus;"1"===o||"3"===o?this.$confirm("是否确认删除(任务名称:"+e.jobName+"), 是否继续?删除后不可恢复","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){return Object(r["b"])(e.jobId)})).then((function(){t.getList(t.page),t.$notify.success("删除成功")})).catch((function(){})):this.$notify.error("运行中定时任务不可删除，请先暂停后操作")},handleJobLog:function(e){var t=this;this.dialogFormVisible=!0,this.$nextTick((function(){t.$refs.logRef.getJobLog(e)}))},getDicJobExecuteStatusCache:function(e){var t=this;Object(c["i"])(e).then((function(e){var o=e.data.code;if(0===o){var n=e.data;t.JobExecuteStatusDicCache=n}}))},getDicJobStatusCache:function(e){var t=this;Object(c["i"])(e).then((function(e){var o=e.data.code;if(0===o){var n=e.data;t.JobStatusDicCache=n}}))},getDicNameJobExecuteStatus:function(e){var t="";return this.JobExecuteStatusDicCache.forEach((function(o){o.value!==e||(t=o.label)})),t},getDicNameJobStatus:function(e){var t="";return this.JobStatusDicCache.forEach((function(o){o.value!==e||(t=o.label)})),t}}},p=b,h=o("2877"),f=Object(h["a"])(p,n,a,!1,null,"1bfac224",null);t["default"]=f.exports}}]);