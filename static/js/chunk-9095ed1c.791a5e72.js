(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-9095ed1c"],{"1e9f":function(e,t,n){},"6a9d":function(e,t,n){"use strict";n.r(t),n.d(t,"fetchTree",(function(){return i})),n.d(t,"addObj",(function(){return a})),n.d(t,"getObj",(function(){return o})),n.d(t,"delObj",(function(){return s})),n.d(t,"putObj",(function(){return u}));var r=n("b775");function i(e){return Object(r["default"])({url:"/admin/dept/tree",method:"get",params:e})}function a(e){return Object(r["default"])({url:"/admin/dept/",method:"post",data:e})}function o(e){return Object(r["default"])({url:"/admin/dept/"+e,method:"get",header:{from:"Y"}})}function s(e){return Object(r["default"])({url:"/admin/dept/"+e,method:"delete"})}function u(e){return Object(r["default"])({url:"/admin/dept/",method:"put",data:e})}},"8d55":function(e,t,n){"use strict";n.r(t),n.d(t,"roleList",(function(){return i})),n.d(t,"fetchList",(function(){return a})),n.d(t,"deptRoleList",(function(){return o})),n.d(t,"getObj",(function(){return s})),n.d(t,"addObj",(function(){return u})),n.d(t,"putObj",(function(){return d})),n.d(t,"delObj",(function(){return l})),n.d(t,"permissionUpd",(function(){return c})),n.d(t,"fetchRoleTree",(function(){return f}));var r=n("b775");function i(){return Object(r["default"])({url:"/admin/role/roleList",method:"get"})}function a(e){return Object(r["default"])({url:"/admin/role/page",method:"get",params:e})}function o(){return Object(r["default"])({url:"/admin/role/list",method:"get"})}function s(e){return Object(r["default"])({url:"/admin/role/"+e,method:"get"})}function u(e){return Object(r["default"])({url:"/admin/role",method:"post",data:e})}function d(e){return Object(r["default"])({url:"/admin/role",method:"put",data:e})}function l(e){return Object(r["default"])({url:"/admin/role/"+e,method:"delete"})}function c(e,t){return Object(r["default"])({url:"/admin/role/menu",method:"put",data:{roleId:e,menuIds:t}})}function f(e){return Object(r["default"])({url:"/admin/menu/tree/"+e,method:"get"})}},b5ee:function(e,t,n){"use strict";var r=n("1e9f"),i=n.n(r);i.a},e378:function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("basic-container",[n("div",{staticClass:"user"},[n("el-row",{attrs:{span:24}},[n("el-col",{staticClass:"user__tree",attrs:{xs:24,sm:24,md:5}},[n("avue-tree",{attrs:{option:e.treeOption,data:e.treeData},on:{"node-click":e.nodeClick}})],1),e._v(" "),n("el-col",{staticClass:"user__main",attrs:{xs:24,sm:24,md:19}},[n("avue-crud",{ref:"crud",attrs:{option:e.option,page:e.page,"table-loading":e.listLoading,"before-open":e.handleOpenBefore,data:e.list},on:{"on-load":e.getList,"search-change":e.searchChange,"refresh-change":e.refreshChange,"size-change":e.sizeChange,"current-change":e.currentChange,"row-update":e.update,"row-save":e.create},scopedSlots:e._u([{key:"username",fn:function(t){return[n("span",[e._v(e._s(t.row.username))])]}},{key:"role",fn:function(t){return e._l(t.row.roleList,(function(t,r){return n("span",{key:r},[n("el-tag",[e._v(e._s(t.roleName)+" ")]),e._v("  \n          ")],1)}))}},{key:"deptId",fn:function(t){return[e._v("\n          "+e._s(t.row.deptName)+"\n        ")]}},{key:"lockFlag",fn:function(t){return[n("el-tag",[e._v(e._s(t.label))])]}},{key:"menu",fn:function(t){return[e.sys_user_edit?n("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-edit"},on:{click:function(n){return e.handleUpdate(t.row,t.index)}}},[e._v("编辑\n          ")]):e._e(),e._v(" "),e.sys_user_del?n("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-delete"},on:{click:function(n){return e.deletes(t.row,t.index)}}},[e._v("删除\n          ")]):e._e()]}},{key:"deptIdForm",fn:function(t){return[n("avue-input-tree",{attrs:{"node-click":e.getNodeData,dic:e.treeDeptData,props:e.defaultProps,placeholder:"请选择所属部门"},model:{value:e.form.deptId,callback:function(t){e.$set(e.form,"deptId",t)},expression:"form.deptId"}})]}},{key:"roleForm",fn:function(t){return[n("avue-select",{attrs:{dic:e.rolesOptions,props:e.roleProps,multiple:"",placeholder:"请选择角色"},model:{value:e.role,callback:function(t){e.role=t},expression:"role"}})]}}]),model:{value:e.form,callback:function(t){e.form=t},expression:"form"}},[n("template",{slot:"menuLeft"},[e.sys_user_add?n("el-button",{staticClass:"filter-item",attrs:{type:"primary",size:"mini",icon:"el-icon-edit"},on:{click:e.handleCreate}},[e._v("添加\n          ")]):e._e()],1)],2)],1)],1)],1)])},i=[],a=(n("6762"),n("2fdb"),n("5530")),o=n("e17e"),s=n("8d55"),u=n("6a9d"),d=function(e,t,n){Object(o["f"])(t).then((function(e){"edit"===window.boxType&&n();var t=e.data;null!==t?n(new Error("用户名已经存在")):n()}))},l={border:!0,index:!0,indexLabel:"序号",stripe:!0,menuAlign:"center",searchMenuSpan:6,editBtn:!1,delBtn:!1,align:"center",addBtn:!1,column:[{fixed:!0,label:"id",prop:"userId",span:24,hide:!0,type:"number",editDisplay:!1,addDisplay:!1},{fixed:!0,label:"用户名",prop:"username",editDisabled:!0,slot:!0,search:!0,span:24,rules:[{required:!0,message:"请输入用户名"},{min:3,max:20,message:"长度在 3 到 20 个字符",trigger:"blur"},{validator:d,trigger:"blur"}]},{label:"密码",prop:"password",type:"password",value:"",hide:!0,span:24,rules:[{min:6,max:20,message:"长度在 6 到 20 个字符",trigger:"blur"}]},{label:"所属部门",prop:"deptId",formslot:!0,slot:!0,span:24,hide:!1,dataType:"number",rules:[{required:!0,message:"请选择部门",trigger:"change"}]},{label:"手机号",prop:"phone",type:"tel",value:"",span:24,rules:[{min:11,max:11,message:"长度在 11 个字符",trigger:"blur"}]},{label:"角色",prop:"role",formslot:!0,slot:!0,overHidden:!0,span:24,rules:[{required:!0,message:"请选择角色",trigger:"blur"}]},{label:"状态",prop:"lockFlag",type:"radio",slot:!0,border:!0,span:24,rules:[{required:!0,message:"请选择状态",trigger:"blur"}],dicData:[{label:"有效",value:"0"},{label:"锁定",value:"9"}]},{width:180,label:"创建时间",prop:"createTime",type:"datetime",format:"yyyy-MM-dd HH:mm",valueFormat:"yyyy-MM-dd HH:mm:ss",editDisabled:!0,addDisplay:!1,span:24}]},c=n("2f62"),f={name:"SysUser",data:function(){return{searchForm:{},treeOption:{nodeKey:"id",addBtn:!1,menu:!1,defaultExpandAll:!0,filter:!0,props:{label:"name",value:"id"}},treeData:[],option:l,treeDeptData:[],checkedKeys:[],roleProps:{label:"roleName",value:"roleId"},defaultProps:{label:"name",value:"id"},page:{total:0,currentPage:1,pageSize:20,isAsc:!1},list:[],listLoading:!0,role:[],form:{},rolesOptions:[]}},computed:Object(a["a"])({},Object(c["mapGetters"])(["permissions"])),watch:{role:function(){this.form.role=this.role}},created:function(){this.sys_user_add=this.permissions["sys_user_add"],this.sys_user_edit=this.permissions["sys_user_edit"],this.sys_user_del=this.permissions["sys_user_del"],this.init()},methods:{init:function(){var e=this;Object(u["fetchTree"])().then((function(t){e.treeData=t.data}))},nodeClick:function(e){this.page.page=1,this.getList(this.page,{deptId:e.id})},getList:function(e,t){var n=this;this.listLoading=!0,Object(o["c"])(Object.assign({current:e.currentPage,size:e.pageSize},t,this.searchForm)).then((function(e){console.log(e),n.list=e.data.records,n.page.total=e.data.total,n.listLoading=!1}))},getNodeData:function(){var e=this;Object(s["deptRoleList"])().then((function(t){e.rolesOptions=t.data}))},handleDept:function(){var e=this;Object(u["fetchTree"])().then((function(t){e.treeDeptData=t.data,console.log(e.treeDeptData)}))},searchChange:function(e,t){this.searchForm=e,this.getList(this.page,e),t()},sizeChange:function(e){this.page.pageSize=e},currentChange:function(e){this.page.currentPage=e},refreshChange:function(){this.getList(this.page)},handleCreate:function(){this.$refs.crud.rowAdd()},handleOpenBefore:function(e,t){var n=this;if(window.boxType=t,this.handleDept(),["edit","views"].includes(t)){this.role=[];for(var r=0;r<this.form.roleList.length;r++)this.role[r]=this.form.roleList[r].roleId;Object(s["deptRoleList"])().then((function(e){console.log(e),n.rolesOptions=e.data}))}else"add"===t&&(this.role=[]);e()},handleUpdate:function(e,t){this.$refs.crud.rowEdit(e,t),this.form.password=void 0},create:function(e,t,n){var r=this;this.form.phone.indexOf("*")>0&&(this.form.phone=void 0),Object(o["a"])(this.form).then((function(){r.getList(r.page),t(),r.$notify.success("创建成功")})).catch((function(){n()}))},update:function(e,t,n,r){var i=this;this.form.phone&&this.form.phone.indexOf("*")>0&&(this.form.phone=void 0),Object(o["g"])(this.form).then((function(){i.getList(i.page),n(),i.$notify.success("修改成功")})).catch((function(){r()}))},deletes:function(e,t){var n=this;this.$confirm("此操作将永久删除该用户(用户名:"+e.username+"), 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(o["b"])(e.userId).then((function(){n.list.splice(t,1),n.$notify.success("删除成功")})).catch((function(){n.$notify.error("删除失败")}))}))}}},p=f,h=(n("b5ee"),n("2877")),m=Object(h["a"])(p,r,i,!1,null,null,null);t["default"]=m.exports}}]);